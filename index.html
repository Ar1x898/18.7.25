<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Locked Gallery</title>
  <meta name="description" content="A simple, customizable locked gallery with click-to-reveal notes." />
  <style>
    :root{
      --bg:#0b0f14; --surface:#121821; --card:#0e141c; --edge:#1e293b;
      --text:#e5e7eb; --muted:#94a3b8; --accent:#5eead4; --accent-2:#60a5fa;
      --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35); --maxw:1200px;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background:url('https://github.com/Ar1x898/18.7.25/raw/main/1month.jpg') center/cover no-repeat;
      color:#5c3d4c; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .hidden{display:none!important}
    header{position:sticky;top:0;z-index:5;background:linear-gradient(to right,#fbcfe8,#f9a8d4);border-bottom:1px solid #f472b6}
    .bar{max-width:var(--maxw);margin:0 auto;padding:14px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .title{font-weight:700;letter-spacing:.2px;display:flex;align-items:center;gap:10px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 9px var(--accent)}
    .btn{background:#f472b6;color:#fff;border:none;border-radius:999px;padding:10px 14px;cursor:pointer;font-weight:600}
    .btn:hover{background:#ec4899}
    main{max-width:var(--maxw);margin:28px auto;padding:0 20px 40px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    @media (max-width:1100px){.grid{grid-template-columns:repeat(8,1fr)}}
    @media (max-width:740px){.grid{grid-template-columns:repeat(4,1fr)}}
    .card{grid-column:span 4;background:linear-gradient(180deg,#fff0f5,#ffe4e1);border:1px solid #fbb6ce;border-radius:var(--radius);overflow:clip;box-shadow:0 8px 20px rgba(255,192,203,.4);position:relative;transition:transform .2s,border-color .2s,box-shadow .2s;isolation:isolate}
    .card:hover{transform:scale(1.02);border-color:#f472b6;box-shadow:0 12px 28px rgba(255,182,193,.6)}
    .card img{width:100%;height:220px;display:block;object-fit:cover;background:#0a0f16;user-select:none;-webkit-user-drag:none}
    .card .controls{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 12px;background:#fff0f5;border-top:1px solid #fbcfe8}
    .label{font-size:14px;color:#933b4b;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .note-toggle{background:#f9a8d4;border:1px solid #f472b6;color:#fff;border-radius:10px;padding:8px 10px;font-weight:600;cursor:pointer}
    .note-toggle:hover{background:#f472b6}
    .note{position:absolute;inset:auto 10px 10px 10px;background:rgba(255,240,245,.95);border:1px solid #f9a8d4;border-radius:12px;padding:12px 14px;box-shadow:0 10px 30px rgba(0,0,0,.5);transform:translateY(6px);transition:opacity .18s,transform .18s;color:#5c3d4c}
    .note[hidden]{opacity:0;transform:translateY(12px);pointer-events:none}
    .note p{margin:0;line-height:1.45;color:#4b2e39}
    .note small{color:#7c4d60;display:block;margin-top:8px}
    /* Gate */
    .gate{position:fixed;inset:0;z-index:9999;display:grid;place-items:center;background:url('https://github.com/Ar1x898/18.7.25/raw/main/binary.jpg') center/cover no-repeat;font-family:'Courier New',Courier,monospace;color:#00ffcc;text-shadow:0 0 5px #00ffcc;padding:20px}
    .panel{width:min(560px,92vw);background:rgba(0,0,0,.82);border:1px solid #00ffcc;border-radius:12px;box-shadow:0 0 20px #00ffccaa;padding:24px}
    .panel h1{margin:0 0 4px;font-size:20px;letter-spacing:.2px;color:#eafffb}
    .panel p.sub{margin:0 0 14px;color:#8bf0e0;font-size:14px}
    .field{display:flex;gap:10px;align-items:center;background:#071218;border:1px solid #0aaea0;border-radius:12px;padding:10px 10px}
    input[type="password"]{flex:1;background:transparent;border:none;outline:none;color:#eafffb;font-size:16px;padding:6px 4px}
    .unlock{white-space:nowrap;border:1px solid #0aaea0;background:linear-gradient(180deg,#0a2a2f,#091c20);color:#eafffb;border-radius:10px;padding:10px 12px;font-weight:700;cursor:pointer}
    .unlock:hover{border-color:#29ffd3}
    .msg{min-height:24px;margin-top:10px;color:#ffb3be;font-weight:700}
    .hint{color:#9deee3;font-size:12px;margin-top:8px}
    @keyframes shake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}
    .shake{animation:shake .35s both}
    noscript{display:block;max-width:740px;margin:40px auto;padding:16px;border:1px solid #b91c1c;border-radius:12px;background:#7f1d1d;color:#fee2e2;font-weight:600}
  </style>
</head>
<body>

<noscript>
  This site needs JavaScript to run. Enable JS to enter your access code and continue.
</noscript>

<!-- ===== ACCESS GATE ===== -->
<div id="gate" class="gate" aria-labelledby="gateTitle">
  <div class="panel" id="gatePanel">
    <h1 id="gateTitle">Enter the access code</h1>
    <p class="sub">Type either the plaintext code <em>or</em> the SHA-256 hex. Correct entry unlocks and takes you to the main page.</p>
    <form id="gateForm" autocomplete="off">
      <div class="field">
        <input id="pass" type="password" inputmode="text" placeholder="Access code or SHA-256 hex" aria-label="Access code" required />
        <button class="unlock" type="submit" id="unlockBtn">Unlock</button>
      </div>
      <div id="gateMsg" class="msg" role="alert" aria-live="polite"></div>
      <div class="hint">Tip: if you paste a 64-char hex, it’s checked as a hash directly.</div>
    </form>
  </div>
</div>

<!-- ===== OPTIONAL APP (fallback if you don’t redirect) ===== -->
<header class="hidden" id="appHeader">
  <div class="bar">
    <div class="title"><span class="dot" aria-hidden="true"></span> <span id="siteTitle">Locked Gallery</span></div>
    <div class="actions">
      <button class="btn" id="lockBtn" title="Lock">Lock</button>
    </div>
  </div>
</header>

<main id="app" class="hidden" tabindex="-1">
  <section aria-label="Image notes gallery">
    <div id="gallery" class="grid" role="list"></div>
  </section>
</main>

<script>
  // ===== CONFIG =====
  const CONFIG = {
    siteTitle: "1 Month Anniversary",
    clickAnywhereToToggle: true,
    rememberHours: 24,
    // Where to go after a successful preliminary check:
    MAIN_URL: "main.html", // ← change this to your real page/route
    images: [
      { src: "assets/photo1.jpg", alt: "Sample image 1", label: "Photo #1", note: "This is an example note. Replace me." },
      { src: "assets/photo2.jpg", alt: "Sample image 2", label: "Photo #2", note: "Another note for your image." },
      { src: "assets/photo3.jpg", alt: "Sample image 3", label: "Photo #3", note: "Click again to hide this note." }
    ],
    // SHA-256 hashes of allowed access codes (hex, lowercase).
    passwordHashes: [
      "3976306e17c6d9bff19e990aa442e0b6ba233ea4b1854bde1e9d1abf7b036558", // "changeme" (example)
      "5dfd46e27a5e3e8e06fcb92817b0955f7fd28048f5003bfd4e5be8e67bf417db"  // add your own…
    ]
  };
</script>

<script>
  // ===== Utilities =====
  const STORAGE_KEY = "siteAuth.v1";

  const PLACEHOLDER_SVG =
    'data:image/svg+xml;utf8,' +
    encodeURIComponent(`
      <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800">
        <defs>
          <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#1f2937"/><stop offset="100%" stop-color="#0b1020"/>
          </linearGradient>
        </defs>
        <rect width="100%" height="100%" fill="url(#g)"/>
        <g fill="#93c5fd" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" text-anchor="middle">
          <text x="50%" y="48%" font-size="36">Add your image at</text>
          <text x="50%" y="56%" font-size="28">CONFIG.images</text>
        </g>
      </svg>
    `);

  function isSha256Hex(s){
    return typeof s === 'string' && /^[0-9a-f]{64}$/i.test(s);
  }

  async function sha256Hex(text){
    const bytes = new TextEncoder().encode(text);
    const hash = await crypto.subtle.digest('SHA-256', bytes);
    return [...new Uint8Array(hash)].map(b => b.toString(16).padStart(2,'0')).join('');
  }

  function setRemembered(hash){
    try {
      const ttl = Math.max(1, Number(CONFIG.rememberHours) || 24);
      const rec = { hash, exp: Date.now() + ttl * 3600 * 1000 };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(rec));
    } catch(_) {}
  }
  function hasValidRemember(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return false;
      const rec = JSON.parse(raw);
      if(!rec || typeof rec.hash !== 'string' || typeof rec.exp !== 'number') return false;
      if(Date.now() > rec.exp){ localStorage.removeItem(STORAGE_KEY); return false; }
      return CONFIG.passwordHashes.includes(rec.hash);
    } catch(_) { return false; }
  }
  function clearRemember(){ try{ localStorage.removeItem(STORAGE_KEY); }catch(_){} }

  function setSiteTitle(){
    const t = CONFIG.siteTitle || "Locked Gallery";
    document.title = t;
    const el = document.getElementById('siteTitle');
    if (el) el.textContent = t;
  }

  // ===== Gate / App =====
  const gate = document.getElementById('gate');
  const panel = document.getElementById('gatePanel');
  const form = document.getElementById('gateForm');
  const passInput = document.getElementById('pass');
  const unlockBtn = document.getElementById('unlockBtn');
  const gateMsg = document.getElementById('gateMsg');
  const app = document.getElementById('app');
  const appHeader = document.getElementById('appHeader');

  function showApp(){
    gate.style.display = 'none';
    appHeader.classList.remove('hidden');
    app.classList.remove('hidden');
    app.focus({ preventScroll: true });
  }
  function showGate(){
    gate.style.display = 'grid';
    appHeader.classList.add('hidden');
    app.classList.add('hidden');
    passInput.value = '';
    gateMsg.textContent = '';
    setTimeout(() => passInput.focus(), 0);
  }

  function onSuccess(hash){
    setRemembered(hash);
    if (CONFIG.MAIN_URL && typeof CONFIG.MAIN_URL === 'string' && CONFIG.MAIN_URL.trim()){
      // Prevent redirect loop if you reuse this file as MAIN_URL by mistake:
      const dest = CONFIG.MAIN_URL.trim();
      const here = location.href.replace(location.hash,'');
      if (!here.endsWith('/' + dest) && !here.endsWith(dest)){
        location.assign(dest);
        return;
      }
    }
    // Fallback: reveal in-page gallery
    showApp();
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const pwRaw = passInput.value.trim();
    if (!pwRaw) return;

    unlockBtn.disabled = true;
    gateMsg.textContent = 'Checking…';

    try{
      let hex = '';
      if (isSha256Hex(pwRaw)){
        hex = pwRaw.toLowerCase();
      } else {
        hex = await sha256Hex(pwRaw);
      }
      if (CONFIG.passwordHashes.includes(hex)) {
        onSuccess(hex);
      } else {
        gateMsg.textContent = "Incorrect code. Try again.";
        panel.classList.remove('shake'); void panel.offsetWidth; panel.classList.add('shake');
      }
    } catch(err){
      gateMsg.textContent = "Something went wrong. Please try again.";
    } finally {
      unlockBtn.disabled = false;
    }
  });

  const lockBtn = document.getElementById('lockBtn');
  lockBtn.addEventListener('click', () => {
    clearRemember();
    showGate();
    // If you were on MAIN_URL, you might want to bounce back to the gate page route:
    // location.replace('gate.html');
  });

  // ===== Gallery builder (optional) =====
  function el(tag, attrs={}, ...children){
    const node = document.createElement(tag);
    for (const [k,v] of Object.entries(attrs)){
      if (v == null) continue;
      if (k === 'class') node.className = v;
      else if (k.startsWith('on') && typeof v === 'function') node.addEventListener(k.slice(2), v);
      else if (k === 'html') node.innerHTML = v;
      else node.setAttribute(k, v);
    }
    for (const c of children){
      if (c == null) continue;
      node.appendChild(typeof c === 'string' ? document.createTextNode(c) : c);
    }
    return node;
  }

  function buildGallery(items){
    const list = document.getElementById('gallery');
    list.innerHTML = '';
    const data = Array.isArray(items) && items.length ? items : [{
      src: PLACEHOLDER_SVG, alt: "Placeholder image", label: "Sample", note: "Edit CONFIG.images in the HTML to add your own images and notes."
    }];

    data.forEach((it, i) => {
      const noteId = `note-${i}`;
      const img = el('img', { src: it.src || PLACEHOLDER_SVG, alt: it.alt || "" });
      const btn = el('button', { class: 'note-toggle', 'aria-controls': noteId, 'aria-expanded': 'false', type: 'button' }, 'Show note');
      const label = el('div', { class: 'label', title: it.label || '' }, it.label || '');
      const controls = el('div', { class: 'controls' }, label, btn);
      const note = el('figcaption', { class: 'note', id: noteId, hidden: true }, el('p', {}, it.note || ''));

      const card = el('figure', { class: 'card', role: 'listitem' }, img, controls, note);

      function toggleNote(){
        const willShow = note.hidden;
        note.hidden = !willShow;
        btn.setAttribute('aria-expanded', String(willShow));
        btn.textContent = willShow ? 'Hide note' : 'Show note';
      }
      btn.addEventListener('click', toggleNote);

      if (CONFIG.clickAnywhereToToggle) {
        img.style.cursor = 'pointer';
        card.addEventListener('click', (ev) => {
          if (ev.target === btn) return;
          toggleNote();
        });
      }

      list.appendChild(card);
    });
  }

  // ===== Init =====
  (function init(){
    setSiteTitle();
    buildGallery(CONFIG.images);
    if (hasValidRemember()){
      onSuccess(JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}").hash || "");
    } else {
      showGate();
    }
  })();
</script>

</body>
</html>
