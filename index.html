<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Locked Gallery</title>
  <meta name="description" content="Two-stage lock: preliminary gate, then gallery unlock." />
  <style>
    :root{
      --bg:#0b0f14; --surface:#121821; --card:#0e141c; --edge:#1e293b;
      --text:#e5e7eb; --muted:#94a3b8; --accent:#5eead4; --accent-2:#60a5fa;
      --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35); --maxw:1200px;
      --pink1:#fbcfe8; --pink2:#f9a8d4; --pink3:#f472b6;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background:url('https://github.com/Ar1x898/18.7.25/raw/main/1month.jpg') center/cover no-repeat;
      color:#5c3d4c; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .hidden{display:none!important}
    header{position:sticky;top:0;z-index:5;background:linear-gradient(to right,var(--pink1),var(--pink2));border-bottom:1px solid var(--pink3)}
    .bar{max-width:var(--maxw);margin:0 auto;padding:14px 20px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .title{font-weight:700;letter-spacing:.2px;display:flex;align-items:center;gap:10px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 9px var(--accent)}
    .btn{background:var(--pink3);color:#fff;border:none;border-radius:999px;padding:10px 14px;cursor:pointer;font-weight:600}
    .btn:hover{background:#ec4899}
    main{max-width:var(--maxw);margin:28px auto;padding:0 20px 40px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    @media (max-width:1100px){.grid{grid-template-columns:repeat(8,1fr)}}
    @media (max-width:740px){.grid{grid-template-columns:repeat(4,1fr)}}
    .card{grid-column:span 4;background:linear-gradient(180deg,#fff0f5,#ffe4e1);border:1px solid #fbb6ce;border-radius:var(--radius);overflow:clip;box-shadow:0 8px 20px rgba(255,192,203,.4);position:relative;transition:transform .2s,border-color .2s,box-shadow .2s;isolation:isolate}
    .card:hover{transform:scale(1.02);border-color:var(--pink3);box-shadow:0 12px 28px rgba(255,182,193,.6)}
    .card img{width:100%;height:220px;display:block;object-fit:cover;background:#0a0f16;user-select:none;-webkit-user-drag:none}
    .card .controls{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 12px;background:#fff0f5;border-top:1px solid #fbcfe8}
    .label{font-size:14px;color:#933b4b;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .note-toggle{background:#f9a8d4;border:1px solid #f472b6;color:#fff;border-radius:10px;padding:8px 10px;font-weight:600;cursor:pointer}
    .note-toggle:hover{background:#f472b6}
    .note{position:absolute;inset:auto 10px 10px 10px;background:rgba(255,240,245,.95);border:1px solid #f9a8d4;border-radius:12px;padding:12px 14px;box-shadow:0 10px 30px rgba(0,0,0,.5);transform:translateY(6px);transition:opacity .18s,transform .18s;color:#5c3d4c}
    .note[hidden]{opacity:0;transform:translateY(12px);pointer-events:none}
    .note p{margin:0;line-height:1.45;color:#4b2e39}
    .note small{color:#7c4d60;display:block;margin-top:8px}

    /* Full-screen gate (preliminary) */
    .gate{position:fixed;inset:0;z-index:9999;display:grid;place-items:center;background:url('https://github.com/Ar1x898/18.7.25/raw/main/binary.jpg') center/cover no-repeat;font-family:'Courier New',Courier,monospace;color:#00ffcc;text-shadow:0 0 5px #00ffcc;padding:20px}
    .panel{width:min(560px,92vw);background:rgba(0,0,0,.82);border:1px solid #00ffcc;border-radius:12px;box-shadow:0 0 20px #00ffccaa;padding:24px}
    .panel h1{margin:0 0 4px;font-size:20px;letter-spacing:.2px;color:#eafffb}
    .panel p.sub{margin:0 0 14px;color:#8bf0e0;font-size:14px}
    .field{display:flex;gap:10px;align-items:center;background:#071218;border:1px solid #0aaea0;border-radius:12px;padding:10px}
    input[type="password"]{flex:1;background:transparent;border:none;outline:none;color:#eafffb;font-size:16px;padding:6px 4px}
    .unlock{white-space:nowrap;border:1px solid #0aaea0;background:linear-gradient(180deg,#0a2a2f,#091c20);color:#eafffb;border-radius:10px;padding:10px 12px;font-weight:700;cursor:pointer}
    .unlock:hover{border-color:#29ffd3}
    .msg{min-height:24px;margin-top:10px;color:#ffb3be;font-weight:700}
    @keyframes shake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}
    .shake{animation:shake .35s both}
    noscript{display:block;max-width:740px;margin:40px auto;padding:16px;border:1px solid #b91c1c;border-radius:12px;background:#7f1d1d;color:#fee2e2;font-weight:600}

    /* Gallery veil (stage 2) */
    .gallery-wrap{position:relative}
    .gallery-veil{
      position:absolute; inset:0; display:grid; place-items:center;
      background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.55));
      backdrop-filter:saturate(0.7) blur(2px);
      border-radius:12px; z-index:3; padding:18px;
    }
    .gallery-blurred{ filter: blur(10px) brightness(0.6); pointer-events:none; }
    .mini-panel{
      width:min(520px,92vw); background:rgba(15,23,42,.85); border:1px solid #60a5fa;
      border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.45); padding:18px; color:#e5e7eb;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    }
    .mini-panel h2{margin:0 0 6px;font-size:18px}
    .mini-panel .field{background:#0b1220;border:1px solid #2a3a52}
    .mini-panel .unlock{border:1px solid #3b82f6;background:linear-gradient(180deg,#102033,#0b1422)}
  </style>
</head>
<body>

<noscript>
  This site needs JavaScript to run. Enable JS to enter your access codes and continue.
</noscript>

<!-- ===== STAGE 1: PRELIM GATE (full screen) ===== -->
<div id="preGate" class="gate" aria-labelledby="preGateTitle">
  <div class="panel" id="preGatePanel">
    <h1 id="preGateTitle">Preliminary Access</h1>
    <p class="sub">Enter the preliminary code to view the page.</p>
    <form id="preForm" autocomplete="off">
      <div class="field">
        <input id="prePass" type="password" inputmode="text" placeholder="Preliminary code" aria-label="Preliminary code" required />
        <button class="unlock" type="submit" id="preBtn">Enter</button>
      </div>
      <div id="preMsg" class="msg" role="alert" aria-live="polite"></div>
    </form>
  </div>
</div>

<!-- ===== APP (visible after Stage 1) ===== -->
<header class="hidden" id="appHeader">
  <div class="bar">
    <div class="title"><span class="dot" aria-hidden="true"></span> <span id="siteTitle">Locked Gallery</span></div>
    <div class="actions">
      <button class="btn" id="lockGalleryBtn" title="Lock gallery">Lock Gallery</button>
      <button class="btn" id="lockAllBtn" title="Lock everything">Lock All</button>
    </div>
  </div>
</header>

<main id="app" class="hidden" tabindex="-1">
  <section aria-label="Image notes gallery" class="gallery-wrap">
    <div id="gallery" class="grid gallery-blurred" role="list"></div>

    <!-- ===== STAGE 2: GALLERY VEIL ===== -->
    <div id="galleryVeil" class="gallery-veil" aria-labelledby="galleryTitle">
      <div class="mini-panel" id="galleryPanel">
        <h2 id="galleryTitle">Unlock Gallery</h2>
        <p class="sub">Enter the gallery code to reveal the pictures.</p>
        <form id="galleryForm" autocomplete="off">
          <div class="field">
            <input id="galleryPass" type="password" inputmode="text" placeholder="Gallery code" aria-label="Gallery code" required />
            <button class="unlock" type="submit" id="galleryBtn">Unlock</button>
          </div>
          <div id="galleryMsg" class="msg" role="alert" aria-live="polite"></div>
        </form>
      </div>
    </div>
  </section>
</main>

<script>
  // ================= CONFIG =================
  const CONFIG = {
    siteTitle: "1 Month Anniversary",
    clickAnywhereToToggle: true,

    prelim: {
      password: "FRANCESCA",     // <— set preliminary plaintext password here
      rememberHours: 12,
      caseSensitive: false
    },
    gallery: {
      password: "STEVEN",     // <— set gallery plaintext password here
      rememberHours: 24,
      caseSensitive: false
    },

    images: [
      // Replace these with real paths. Missing images will auto-fallback to a placeholder.
      { src: "assets/photo1.jpg", alt: "Sample image 1", label: "Photo #1", note: "This is an example note. Replace me." },
      { src: "assets/photo2.jpg", alt: "Sample image 2", label: "Photo #2", note: "Another note for your image." },
      { src: "assets/photo3.jpg", alt: "Sample image 3", label: "Photo #3", note: "Click again to hide this note." }
    ]
  };
</script>

<script>
  // =============== Utilities & Storage ===============
  const STORE_PRE  = "auth.prelim.v1";
  const STORE_GAL  = "auth.gallery.v1";

  function now(){ return Date.now(); }
  function remember(key, hours){
    try{
      const ttl = Math.max(1, Number(hours)||1);
      localStorage.setItem(key, JSON.stringify({ exp: now() + ttl*3600*1000 }));
    }catch(_){}
  }
  function hasRemember(key){
    try{
      const raw = localStorage.getItem(key);
      if(!raw) return false;
      const rec = JSON.parse(raw);
      if(!rec || typeof rec.exp!=='number') return false;
      if(now()>rec.exp){ localStorage.removeItem(key); return false; }
      return true;
    }catch(_){ return false; }
  }
  function clearRemember(key){ try{ localStorage.removeItem(key); }catch(_){ } }

  // =============== DOM refs ===============
  const preGate     = document.getElementById('preGate');
  const prePanel    = document.getElementById('preGatePanel');
  const preForm     = document.getElementById('preForm');
  const prePass     = document.getElementById('prePass');
  const preBtn      = document.getElementById('preBtn');
  const preMsg      = document.getElementById('preMsg');

  const appHeader   = document.getElementById('appHeader');
  const app         = document.getElementById('app');
  const siteTitleEl = document.getElementById('siteTitle');

  const gallery     = document.getElementById('gallery');
  const galleryVeil = document.getElementById('galleryVeil');
  const galleryPanel= document.getElementById('galleryPanel');
  const galleryForm = document.getElementById('galleryForm');
  const galleryPass = document.getElementById('galleryPass');
  const galleryBtn  = document.getElementById('galleryBtn');
  const galleryMsg  = document.getElementById('galleryMsg');

  const lockGalleryBtn = document.getElementById('lockGalleryBtn');
  const lockAllBtn     = document.getElementById('lockAllBtn');

  // =============== Helpers ===============
  function normalize(input, caseSensitive){
    return caseSensitive ? String(input||"") : String(input||"").toLowerCase();
  }
  function matches(input, target, caseSensitive){
    return normalize(input, caseSensitive) === normalize(target, caseSensitive);
  }

  function setSiteTitle(){
    document.title = CONFIG.siteTitle || "Locked Gallery";
    if(siteTitleEl) siteTitleEl.textContent = CONFIG.siteTitle || "Locked Gallery";
  }

  function showAppShell(){
    preGate.style.display = 'none';
    appHeader.classList.remove('hidden');
    app.classList.remove('hidden');
  }
  function showPreGate(){
    preGate.style.display = 'grid';
    appHeader.classList.add('hidden');
    app.classList.add('hidden');
    prePass.value = ''; preMsg.textContent = '';
    setTimeout(()=>prePass.focus(), 0);
  }

  function unlockGalleryUI(){
    gallery.classList.remove('gallery-blurred');
    galleryVeil.classList.add('hidden');
  }
  function lockGalleryUI(){
    gallery.classList.add('gallery-blurred');
    galleryVeil.classList.remove('hidden');
    galleryPass.value = ''; galleryMsg.textContent = '';
    setTimeout(()=>galleryPass.focus(), 0);
  }

  // =============== Gallery builder ===============
  const PLACEHOLDER_SVG =
    'data:image/svg+xml;utf8,' + encodeURIComponent(`
      <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800">
        <defs>
          <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#1f2937"/><stop offset="100%" stop-color="#0b1020"/>
          </linearGradient>
        </defs>
        <rect width="100%" height="100%" fill="url(#g)"/>
        <g fill="#93c5fd" font-family="system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial" text-anchor="middle">
          <text x="50%" y="48%" font-size="36">Add your image at</text>
          <text x="50%" y="56%" font-size="28">CONFIG.images</text>
        </g>
      </svg>
    `);

  function el(tag, attrs={}, ...children){
    const node = document.createElement(tag);
    for (const [k,v] of Object.entries(attrs)){
      if (v == null) continue;
      if (k === 'class') node.className = v;
      else if (k.startsWith('on') && typeof v === 'function') node.addEventListener(k.slice(2), v);
      else if (k === 'html') node.innerHTML = v;
      else node.setAttribute(k, v);
    }
    for (const c of children){
      if (c == null) continue;
      node.appendChild(typeof c === 'string' ? document.createTextNode(c) : c);
    }
    return node;
  }

  function buildGallery(items){
    gallery.innerHTML = '';
    const data = Array.isArray(items) && items.length ? items : [{
      src: PLACEHOLDER_SVG, alt: "Placeholder image", label: "Sample", note: "Edit CONFIG.images in the HTML to add your own images and notes."
    }];

    data.forEach((it, i) => {
      const noteId = `note-${i}`;
      const img = el('img', { alt: it.alt || "" });

      // Load with graceful fallback to avoid image 404s
      img.src = it.src || PLACEHOLDER_SVG;
      img.addEventListener('error', () => { img.src = PLACEHOLDER_SVG; });

      const btn = el('button', { class: 'note-toggle', 'aria-controls': noteId, 'aria-expanded': 'false', type: 'button' }, 'Show note');
      const label = el('div', { class: 'label', title: it.label || '' }, it.label || '');
      const controls = el('div', { class: 'controls' }, label, btn);
      const note = el('figcaption', { class: 'note', id: noteId, hidden: true }, el('p', {}, it.note || ''));

      const card = el('figure', { class: 'card', role: 'listitem' }, img, controls, note);

      function toggleNote(){
        const willShow = note.hidden;
        note.hidden = !willShow;
        btn.setAttribute('aria-expanded', String(willShow));
        btn.textContent = willShow ? 'Hide note' : 'Show note';
      }
      btn.addEventListener('click', toggleNote);

      if (CONFIG.clickAnywhereToToggle) {
        img.style.cursor = 'pointer';
        card.addEventListener('click', (ev) => {
          if (ev.target === btn) return;
          toggleNote();
        });
      }

      gallery.appendChild(card);
    });
  }

  // =============== Init & Event handlers ===============
  (function init(){
    setSiteTitle();
    buildGallery(CONFIG.images);

    // Stage 1
    if (hasRemember(STORE_PRE)) {
      showAppShell();
    } else {
      showPreGate();
    }

    // Stage 2 (only auto-unlock after app shell visible)
    if (hasRemember(STORE_GAL)) {
      unlockGalleryUI();
    } else {
      lockGalleryUI();
    }
  })();

  preForm.addEventListener('submit', (e)=>{
    e.preventDefault();
    const input = prePass.value.trim();
    if (!input) return;
    preBtn.disabled = true; preMsg.textContent = 'Checking…';
    const ok = matches(input, CONFIG.prelim.password, CONFIG.prelim.caseSensitive);
    if (ok){
      remember(STORE_PRE, CONFIG.prelim.rememberHours);
      showAppShell();
    } else {
      preMsg.textContent = 'Incorrect preliminary code.';
      prePanel.classList.remove('shake'); void prePanel.offsetWidth; prePanel.classList.add('shake');
    }
    preBtn.disabled = false;
  });

  galleryForm.addEventListener('submit', (e)=>{
    e.preventDefault();
    const input = galleryPass.value.trim();
    if (!input) return;
    galleryBtn.disabled = true; galleryMsg.textContent = 'Checking…';
    const ok = matches(input, CONFIG.gallery.password, CONFIG.gallery.caseSensitive);
    if (ok){
      remember(STORE_GAL, CONFIG.gallery.rememberHours);
      unlockGalleryUI();
    } else {
      galleryMsg.textContent = 'Incorrect gallery code.';
      galleryPanel.classList.remove('shake'); void galleryPanel.offsetWidth; galleryPanel.classList.add('shake');
    }
    galleryBtn.disabled = false;
  });

  lockGalleryBtn.addEventListener('click', ()=>{
    clearRemember(STORE_GAL);
    lockGalleryUI();
  });

  lockAllBtn.addEventListener('click', ()=>{
    clearRemember(STORE_GAL);
    clearRemember(STORE_PRE);
    showPreGate();
  });
</script>

</body>
</html>
